<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NeonVision - AI Image Analysis</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            neon: {
              cyan: '#00f7ff',
              purple: '#a100f7',
              pink: '#ff00e6',
              blue: '#0066ff',
              green: '#00ff9d',
              orange: '#ff7b00',
              yellow: '#ffee00'
            },
            dark: {
              900: '#0a0a0a',
              800: '#121212',
              700: '#1a1a1a',
              600: '#222222',
              500: '#2a2a2a'
            }
          },
          animation: {
            'neon-pulse': 'neonPulse 4s ease-in-out infinite',
            'neon-flicker': 'neonFlicker 8s ease-in-out infinite',
            'float': 'float 6s ease-in-out infinite',
            'glow': 'glow 3s ease-in-out infinite alternate',
            'slide-in': 'slideIn 0.5s ease-out forwards',
            'slide-out': 'slideOut 0.5s ease-in forwards',
            'fade-in': 'fadeIn 0.5s ease-out forwards',
            'fade-out': 'fadeOut 0.5s ease-in forwards',
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'bounce-slow': 'bounce 3s infinite',
            'toast-in': 'toastIn 0.3s ease-out forwards',
            'toast-out': 'toastOut 0.3s ease-in forwards',
            'text-glow': 'textGlow 2s ease-in-out infinite alternate'
          },
          keyframes: {
            neonPulse: {
              '0%, 100%': { 'box-shadow': '0 0 10px rgba(0, 247, 255, 0.5), 0 0 20px rgba(0, 247, 255, 0.3)' },
              '50%': { 'box-shadow': '0 0 20px rgba(0, 247, 255, 0.8), 0 0 40px rgba(0, 247, 255, 0.5)' }
            },
            neonFlicker: {
              '0%, 19.999%, 22%, 62.999%, 64%, 64.999%, 70%, 100%': { opacity: 1 },
              '20%, 21.999%, 63%, 63.999%, 65%, 69.999%': { opacity: 0.7 }
            },
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-20px)' },
            },
            glow: {
              '0%': { 'box-shadow': '0 0 5px rgba(161, 0, 247, 0.5)' },
              '100%': { 'box-shadow': '0 0 20px rgba(161, 0, 247, 0.9)' }
            },
            slideIn: {
              '0%': { transform: 'translateY(50px)', opacity: 0 },
              '100%': { transform: 'translateY(0)', opacity: 1 }
            },
            slideOut: {
              '0%': { transform: 'translateY(0)', opacity: 1 },
              '100%': { transform: 'translateY(50px)', opacity: 0 }
            },
            fadeIn: {
              '0%': { opacity: 0 },
              '100%': { opacity: 1 }
            },
            fadeOut: {
              '0%': { opacity: 1 },
              '100%': { opacity: 0 }
            },
            toastIn: {
              '0%': { transform: 'translateY(20px)', opacity: 0 },
              '100%': { transform: 'translateY(0)', opacity: 1 }
            },
            toastOut: {
              '0%': { transform: 'translateY(0)', opacity: 1 },
              '100%': { transform: 'translateY(20px)', opacity: 0 }
            },
            textGlow: {
              '0%': { 'text-shadow': '0 0 5px rgba(0, 247, 255, 0.5)' },
              '100%': { 'text-shadow': '0 0 15px rgba(0, 247, 255, 0.9)' }
            }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Rajdhani', sans-serif;
      background-color: #0a0a0a;
      color: #e0e0e0;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Orbitron', sans-serif;
      font-weight: 600;
    }
    
    .neon-text {
      background: linear-gradient(90deg, #00f7ff, #a100f7, #ff00e6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(161, 0, 247, 0.5);
    }
    
    .neon-border {
      border: 1px solid rgba(161, 0, 247, 0.3);
      box-shadow: 0 0 15px rgba(161, 0, 247, 0.3);
    }
    
    .neon-card {
      background: linear-gradient(145deg, #121212, #1a1a1a);
      border: 1px solid rgba(161, 0, 247, 0.1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }
    
    .neon-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(161, 0, 247, 0.4);
      border: 1px solid rgba(161, 0, 247, 0.3);
    }
    
    .file-input-label:hover .upload-icon {
      transform: scale(1.1);
      filter: drop-shadow(0 0 8px rgba(0, 247, 255, 0.7));
    }
    
    .file-input-label:hover .upload-text {
      letter-spacing: 1px;
      text-shadow: 0 0 10px rgba(0, 247, 255, 0.7);
    }
    
    .image-preview:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 247, 255, 0.5);
    }
    
    .typing-animation::after {
      content: '...';
      animation: typing 1.5s infinite;
    }
    
    @keyframes typing {
      0% { content: '.'; }
      33% { content: '..'; }
      66% { content: '...'; }
    }
    
    .result-card {
      view-timeline-name: --result;
      view-timeline-axis: block;
      animation-timeline: --result;
      animation-name: show;
      animation-range: entry 25% cover 50%;
      animation-fill-mode: both;
    }
    
    @keyframes show {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .toast {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      z-index: 9999;
    }
    
    .neon-button {
      background: linear-gradient(90deg, #0066ff, #a100f7);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(0, 102, 255, 0.5);
    }
    
    .neon-button:hover {
      background: linear-gradient(90deg, #a100f7, #0066ff);
      box-shadow: 0 0 25px rgba(161, 0, 247, 0.7);
      transform: translateY(-2px);
    }
    
    .neon-button:active {
      transform: translateY(0);
    }
    
    .neon-underline {
      position: relative;
      display: inline-block;
    }
    
    .neon-underline::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, #00f7ff, #a100f7);
      box-shadow: 0 0 10px rgba(0, 247, 255, 0.7);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }
    
    .neon-underline:hover::after {
      transform: scaleX(1);
    }
    
    .neon-grid-bg {
      background-image: 
        linear-gradient(rgba(161, 0, 247, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(161, 0, 247, 0.1) 1px, transparent 1px);
      background-size: 40px 40px;
    }
    
    .neon-scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    
    .neon-scrollbar::-webkit-scrollbar-track {
      background: #121212;
    }
    
    .neon-scrollbar::-webkit-scrollbar-thumb {
      background: linear-gradient(#00f7ff, #a100f7);
      border-radius: 4px;
    }
    
    .neon-scrollbar::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(#a100f7, #00f7ff);
    }
    
    .neon-tab {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .neon-tab::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, #00f7ff, #a100f7);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .neon-tab.active::before {
      transform: scaleX(1);
    }
    
    .neon-tab:hover::before {
      transform: scaleX(1);
    }
    
    .neon-radial-gradient {
      background: radial-gradient(circle at center, rgba(161, 0, 247, 0.1) 0%, transparent 70%);
    }
    
    .chat-message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      margin-bottom: 8px;
      position: relative;
      animation: fadeIn 0.3s ease-out;
    }
    
    .user-message {
      background: linear-gradient(90deg, #0066ff, #a100f7);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    
    .ai-message {
      background: #2a2a2a;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    
    .chat-input {
      background: #222222;
      border: 1px solid rgba(161, 0, 247, 0.3);
      color: white;
      transition: all 0.3s ease;
    }
    
    .chat-input:focus {
      outline: none;
      border-color: #a100f7;
      box-shadow: 0 0 10px rgba(161, 0, 247, 0.5);
    }
    
    .chat-send-btn {
      background: linear-gradient(90deg, #a100f7, #0066ff);
      color: white;
      border: none;
      transition: all 0.3s ease;
    }
    
    .chat-send-btn:hover {
      background: linear-gradient(90deg, #0066ff, #a100f7);
      transform: translateY(-2px);
    }
    
    .chat-container {
      max-height: 300px;
      overflow-y: auto;
    }
    
    .chat-container::-webkit-scrollbar {
      width: 6px;
    }
    
    .chat-container::-webkit-scrollbar-thumb {
      background: linear-gradient(#00f7ff, #a100f7);
      border-radius: 3px;
    }
  </style>
</head>
<body class="min-h-screen neon-grid-bg overflow-x-hidden">
  <!-- Floating Neon Elements -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
    <div class="absolute top-10 left-10 w-32 h-32 rounded-full bg-neon-cyan opacity-10 animate-float blur-xl"></div>
    <div class="absolute top-1/3 right-20 w-40 h-40 rounded-full bg-neon-purple opacity-10 animate-float animation-delay-2000 blur-xl"></div>
    <div class="absolute bottom-20 left-1/4 w-28 h-28 rounded-full bg-neon-pink opacity-10 animate-float animation-delay-3000 blur-xl"></div>
    <div class="absolute bottom-1/3 right-1/4 w-36 h-36 rounded-full bg-neon-blue opacity-10 animate-float animation-delay-1000 blur-xl"></div>
  </div>

  <!-- Toast Notification Container -->
  <div id="toastContainer" class="toast"></div>

  <div class="relative z-10">
    <!-- Header with Neon Glow -->
    <header class="container mx-auto px-4 py-12 text-center">
      <div class="relative inline-block">
        <div class="absolute inset-0 bg-neon-cyan rounded-full blur-3xl opacity-20 animate-neon-pulse"></div>
        <h1 class="text-6xl font-bold mb-4 neon-text relative">
          <i class="fas fa-robot mr-3 animate-text-glow"></i>NeonVision
        </h1>
      </div>
      <p class="text-xl text-gray-400 max-w-2xl mx-auto mt-6">
        Upload your images and experience <span class="neon-text font-medium">next-gen AI analysis</span> with stunning neon visuals
      </p>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 pb-16">
      <div class="flex flex-col lg:flex-row gap-8 items-start">
        <!-- Upload Section -->
        <div class="w-full lg:w-1/2 neon-card rounded-xl p-8 backdrop-blur-sm">
          <div class="flex items-center mb-8">
            <div class="p-3 rounded-full bg-dark-700 border border-neon-cyan border-opacity-30 text-neon-cyan mr-4 shadow-lg shadow-neon-cyan/20">
              <i class="fas fa-cloud-upload-alt text-2xl"></i>
            </div>
            <h2 class="text-3xl font-semibold text-white">Image Upload</h2>
          </div>

          <label for="imageInput" class="file-input-label cursor-pointer">
            <div class="border-2 border-dashed border-neon-purple border-opacity-30 rounded-xl p-8 text-center bg-dark-700 hover:bg-dark-600 transition-all duration-300 neon-radial-gradient">
              <div class="upload-icon transition-transform duration-300">
                <i class="fas fa-images text-5xl text-neon-cyan mb-4 drop-shadow-lg"></i>
              </div>
              <h3 class="upload-text text-xl font-medium text-gray-300 mb-2 transition-all duration-300">
                Click to upload or drag and drop
              </h3>
              <p class="text-sm text-gray-500">
                Supports JPG, PNG, WEBP (Max 10MB)
              </p>
              <input type="file" id="imageInput" accept="image/*" multiple class="hidden" />
            </div>
          </label>

          <div id="previewContainer" class="mt-8 hidden">
            <p class="text-sm font-medium text-gray-400 mb-3">Selected Images</p>
            <div class="flex flex-wrap gap-4" id="imagePreviews"></div>
          </div>

          <button id="describeBtn" class="w-full mt-8 neon-button py-4 px-6 rounded-lg font-semibold transition-all duration-300 hover:opacity-90 flex items-center justify-center">
            <i class="fas fa-magic mr-3 animate-neon-flicker"></i> Analyze Images
          </button>
        </div>

        <!-- Results Section -->
        <div class="w-full lg:w-1/2">
          <div class="neon-card rounded-xl p-8 h-full backdrop-blur-sm neon-radial-gradient">
            <div class="flex items-center mb-8">
              <div class="p-3 rounded-full bg-dark-700 border border-neon-pink border-opacity-30 text-neon-pink mr-4 shadow-lg shadow-neon-pink/20">
                <i class="fas fa-sparkles text-2xl"></i>
              </div>
              <h2 class="text-3xl font-semibold text-white">AI Analysis Results</h2>
            </div>

            <div id="response" class="min-h-[300px] neon-scrollbar max-h-[500px] overflow-y-auto">
              <div class="flex flex-col items-center justify-center h-full text-center p-8">
                <i class="fas fa-image text-5xl text-gray-600 mb-6"></i>
                <h3 class="text-xl font-medium text-gray-400">Your image analysis will appear here</h3>
                <p class="text-gray-500 mt-2">Upload one or more images and click "Analyze Images"</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Features Section -->
      <div class="mt-24 text-center">
        <h2 class="text-4xl font-bold text-white mb-4">Advanced <span class="neon-text">Neon-Powered</span> Analysis</h2>
        <p class="text-gray-400 max-w-3xl mx-auto mb-12">Our cutting-edge AI delivers unparalleled image understanding with stunning visual feedback</p>

        <div class="grid md:grid-cols-3 gap-8">
          <div class="neon-card p-8 rounded-xl transition-all duration-300">
            <div class="w-20 h-20 bg-dark-700 border border-neon-cyan border-opacity-30 rounded-full flex items-center justify-center mb-6 mx-auto shadow-lg shadow-neon-cyan/20">
              <i class="fas fa-eye text-3xl text-neon-cyan"></i>
            </div>
            <h3 class="text-2xl font-semibold mb-3 text-white neon-underline">Object Detection</h3>
            <p class="text-gray-400">Identifies objects with <span class="text-neon-cyan">laser precision</span> using advanced neural networks.</p>
          </div>
          <div class="neon-card p-8 rounded-xl transition-all duration-300">
            <div class="w-20 h-20 bg-dark-700 border border-neon-purple border-opacity-30 rounded-full flex items-center justify-center mb-6 mx-auto shadow-lg shadow-neon-purple/20">
              <i class="fas fa-comment-alt text-3xl text-neon-purple"></i>
            </div>
            <h3 class="text-2xl font-semibold mb-3 text-white neon-underline">Detailed Descriptions</h3>
            <p class="text-gray-400">Generates <span class="text-neon-purple">rich, contextual</span> descriptions of your images.</p>
          </div>
          <div class="neon-card p-8 rounded-xl transition-all duration-300">
            <div class="w-20 h-20 bg-dark-700 border border-neon-pink border-opacity-30 rounded-full flex items-center justify-center mb-6 mx-auto shadow-lg shadow-neon-pink/20">
              <i class="fas fa-bolt text-3xl text-neon-pink"></i>
            </div>
            <h3 class="text-2xl font-semibold mb-3 text-white neon-underline">Lightning Fast</h3>
            <p class="text-gray-400">Processes images at <span class="text-neon-pink">warp speed</span> using Gemini AI.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark-900 py-12 mt-16 border-t border-dark-700">
      <div class="container mx-auto px-4 text-center">
        <div class="flex justify-center space-x-8 mb-6">
          <a href="#" class="text-gray-500 hover:text-neon-cyan transition-colors duration-300 text-2xl">
            <i class="fab fa-twitter"></i>
          </a>
          <a href="#" class="text-gray-500 hover:text-neon-purple transition-colors duration-300 text-2xl">
            <i class="fab fa-github"></i>
          </a>
          <a href="#" class="text-gray-500 hover:text-neon-pink transition-colors duration-300 text-2xl">
            <i class="fab fa-linkedin"></i>
          </a>
          <a href="#" class="text-gray-500 hover:text-neon-blue transition-colors duration-300 text-2xl">
            <i class="fab fa-discord"></i>
          </a>
        </div>
        <p class="text-gray-600 text-sm">
          Powered by <span class="text-neon-cyan">AI</span> • © 2025 <span class="text-neon-purple">NeonVision</span> • All rights reserved
        </p>
      </div>
    </footer>
  </div>

  <script type="module">
    // Replace with your actual API key
    const API_KEY = "AIzaSyDsdvYPIRx0taU2zrCZ_RUeNK7OPQGeLFQ";
    
    // DOM elements
    const fileInput = document.getElementById("imageInput");
    const describeBtn = document.getElementById("describeBtn");
    const responseBox = document.getElementById("response");
    const previewContainer = document.getElementById("previewContainer");
    const imagePreviews = document.getElementById("imagePreviews");
    const toastContainer = document.getElementById("toastContainer");

    // Store chat sessions for each image
    const chatSessions = new Map();

    // Show toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `mb-4 px-6 py-3 rounded-lg shadow-lg font-medium flex items-center ${
        type === 'error' ? 'bg-red-900 border border-red-700 text-red-100' : 
        type === 'warning' ? 'bg-yellow-900 border border-yellow-700 text-yellow-100' : 
        'bg-green-900 border border-green-700 text-green-100'
      } animate-toast-in backdrop-blur-sm`;
      
      const icon = type === 'error' ? 'exclamation-circle' : 
                 type === 'warning' ? 'exclamation-triangle' : 'check-circle';
      
      const iconColor = type === 'error' ? 'text-red-400' : 
                      type === 'warning' ? 'text-yellow-400' : 'text-green-400';
      
      toast.innerHTML = `
        <i class="fas fa-${icon} mr-3 ${iconColor} text-xl"></i>
        <span>${message}</span>
      `;
      
      toastContainer.appendChild(toast);
      
      // Auto-remove after 3 seconds
      setTimeout(() => {
        toast.classList.remove('animate-toast-in');
        toast.classList.add('animate-toast-out');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Handle file selection
    fileInput.addEventListener("change", function() {
      const files = fileInput.files;
      imagePreviews.innerHTML = '';
      
      if (files.length > 0) {
        previewContainer.classList.remove("hidden");
        showToast(`${files.length} image${files.length > 1 ? 's' : ''} selected`, 'success');
        
        for (let i = 0; i < Math.min(files.length, 5); i++) {
          const file = files[i];
          
          // Validate file type
          if (!file.type.match('image.*')) {
            showToast(`Skipped ${file.name} - not an image file`, 'warning');
            continue;
          }
          
          // Validate file size (10MB max)
          if (file.size > 10 * 1024 * 1024) {
            showToast(`Skipped ${file.name} - file too large (max 10MB)`, 'warning');
            continue;
          }
          
          const reader = new FileReader();
          
          reader.onload = function(e) {
            const preview = document.createElement("div");
            preview.className = "relative group image-preview transition-all duration-300 w-24 h-24 rounded-lg overflow-hidden";
            preview.innerHTML = `
              <img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover">
              <div class="absolute inset-0 bg-black bg-opacity-70 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center p-2">
                <span class="text-white text-xs font-medium text-center">${file.name}</span>
              </div>
              <div class="absolute top-2 right-2 w-3 h-3 rounded-full bg-neon-cyan shadow-neon-glow opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            `;
            imagePreviews.appendChild(preview);
          };
          
          reader.onerror = () => {
            showToast(`Error loading ${file.name}`, 'error');
          };
          
          reader.readAsDataURL(file);
        }
        
        if (files.length > 5) {
          const moreText = document.createElement("div");
          moreText.className = "flex items-center justify-center w-24 h-24 bg-dark-700 rounded-lg border border-dashed border-neon-purple border-opacity-30 text-neon-purple text-lg font-bold";
          moreText.textContent = `+${files.length - 5}`;
          imagePreviews.appendChild(moreText);
        }
      } else {
        previewContainer.classList.add("hidden");
      }
    });

    // Handle drag and drop
    const dropArea = document.querySelector('.file-input-label');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      dropArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
      const div = dropArea.querySelector('div');
      div.classList.add('border-neon-purple', 'bg-dark-600');
      div.style.boxShadow = '0 0 30px rgba(161, 0, 247, 0.5)';
    }

    function unhighlight() {
      const div = dropArea.querySelector('div');
      div.classList.remove('border-neon-purple', 'bg-dark-600');
      div.style.boxShadow = '';
    }

    dropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      fileInput.files = files;
      const event = new Event('change');
      fileInput.dispatchEvent(event);
      showToast(`Dropped ${files.length} image${files.length > 1 ? 's' : ''}`, 'success');
    }

    // Handle image description
    describeBtn.addEventListener("click", async function() {
      const files = fileInput.files;
      if (!files || files.length === 0) {
        showToast("Please upload at least one image first!", 'error');
        return;
      }

      // Loading state
      describeBtn.disabled = true;
      describeBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-3"></i> Analyzing...`;
      describeBtn.classList.add('opacity-75');
      
      responseBox.innerHTML = `
        <div class="flex flex-col items-center justify-center h-full p-8">
          <div class="relative w-32 h-32 mb-8">
            <div class="absolute inset-0 rounded-full border-4 border-neon-cyan border-opacity-20 animate-spin"></div>
            <div class="absolute inset-4 rounded-full border-4 border-neon-purple border-opacity-20 animate-spin animation-delay-1000"></div>
            <div class="absolute inset-8 rounded-full border-4 border-neon-pink border-opacity-20 animate-spin animation-delay-2000"></div>
            <div class="absolute inset-12 rounded-full border-4 border-neon-blue border-opacity-20 animate-spin animation-delay-3000"></div>
            <div class="absolute inset-0 flex items-center justify-center">
              <i class="fas fa-atom text-4xl text-neon-cyan animate-spin"></i>
            </div>
          </div>
          <h3 class="text-xl font-medium text-gray-300 mb-2">Processing ${files.length} image${files.length > 1 ? 's' : ''}</h3>
          <p class="text-gray-500 typing-animation">Our AI is analyzing your image${files.length > 1 ? 's' : ''}</p>
        </div>
      `;

      try {
        // Dynamically import the Google Generative AI library
        const { GoogleGenerativeAI } = await import("https://esm.sh/@google/generative-ai");
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        
        let allDescriptions = "";

        for (const [index, file] of Array.from(files).entries()) {
          // Skip non-image files
          if (!file.type.match('image.*')) continue;
          
          // Update progress
          responseBox.innerHTML = `
            <div class="flex flex-col items-center justify-center h-full p-8">
              <div class="relative w-32 h-32 mb-8">
                <div class="radial-progress text-neon-cyan border-4 border-neon-cyan border-opacity-20" style="--value:${Math.round((index + 1) / files.length * 100)}; --size:8rem; --thickness:0.5rem;">
                  <span class="text-neon-cyan text-xl font-bold">${Math.round((index + 1) / files.length * 100)}%</span>
                </div>
                <div class="absolute inset-0 flex items-center justify-center">
                  <i class="fas fa-image text-2xl text-neon-cyan"></i>
                </div>
              </div>
              <h3 class="text-xl font-medium text-gray-300 mb-1">Processing image ${index + 1} of ${files.length}</h3>
              <p class="text-gray-500 truncate max-w-xs">${file.name}</p>
            </div>
          `;

          const base64 = await toBase64(file);
          
          // Start a new chat session for this image
          const chat = model.startChat({
            history: [
              {
                role: "user",
                parts: [{ 
                  inlineData: {
                    mimeType: file.type,
                    data: base64,
                  }
                }],
              },
              {
                role: "model",
                parts: [{ text: "I have received the image. Please provide your analysis request." }],
              },
              {
                role: "user",
                parts: [{ text: "Describe this image in detail, including objects, colors, actions, and any text present. Provide a comprehensive analysis suitable for accessibility purposes." }],
              }
            ]
          });

          const result = await chat.sendMessage("Describe this image in detail, including objects, colors, actions, and any text present. Provide a comprehensive analysis suitable for accessibility purposes.");
          
          // Store the chat session for follow-up questions
          chatSessions.set(file.name, chat);

          const text = result.response.candidates?.[0]?.content?.parts?.[0]?.text;
          if (text) {
            allDescriptions += `
              <div class="result-card mb-8 last:mb-0 neon-card p-6 rounded-lg" data-filename="${file.name}">
                <div class="flex items-start mb-4">
                  <div class="flex-shrink-0 bg-dark-700 border border-neon-cyan border-opacity-20 p-3 rounded-lg mr-4 shadow-neon-cyan/10">
                    <i class="fas fa-image text-neon-cyan"></i>
                  </div>
                  <div>
                    <h4 class="font-semibold text-white text-lg">${file.name}</h4>
                    <p class="text-sm text-gray-400">${formatFileSize(file.size)} • ${file.type}</p>
                  </div>
                </div>
                <div class="bg-dark-700 rounded-lg p-4 border border-dark-600 neon-radial-gradient">
                  <p class="text-gray-300 whitespace-pre-line">${text}</p>
                </div>
                
                <!-- Follow-up chat interface -->
                <div class="mt-6">
                  <div class="flex items-center mb-3">
                    <div class="h-px flex-1 bg-gradient-to-r from-transparent via-neon-purple to-transparent"></div>
                    <span class="px-3 text-sm text-neon-cyan">Ask about this image</span>
                    <div class="h-px flex-1 bg-gradient-to-r from-transparent via-neon-purple to-transparent"></div>
                  </div>
                  
                  <div id="chat-${file.name.replace(/[^a-z0-9]/gi, '-')}" class="chat-container flex flex-col space-y-3 mb-3 max-h-60 overflow-y-auto p-2"></div>
                  
                  <div class="flex gap-1 flex-wrap">
                    <input 
                      type="text" 
                      id="question-${file.name.replace(/[^a-z0-9]/gi, '-')}" 
                      class="chat-input flex-1 rounded-lg px-4 py-2 focus:outline-none" 
                      placeholder="Ask a follow-up question..."
                    >
                    <button 
                      onclick="askFollowUp('${file.name}')" 
                      class="chat-send-btn rounded-lg px-4 py-2 flex items-center justify-center "
                    >
                      <i class="fas fa-paper-plane mr-2"></i> Send
                    </button>
                  </div>
                </div>
                
                <div class="mt-3 flex justify-between">
                  <button class="text-xs text-neon-purple hover:text-neon-cyan transition-colors duration-300 flex items-center" onclick="copyToClipboard(this, '${file.name}')">
                    <i class="fas fa-copy mr-1"></i> Copy
                  </button>
                  <button class="text-xs text-neon-purple hover:text-neon-cyan transition-colors duration-300 flex items-center" onclick="regenerateAnalysis('${file.name}')">
                    <i class="fas fa-sync-alt mr-1"></i> Regenerate
                  </button>
                </div>
              </div>
            `;
          } else {
            allDescriptions += `
              <div class="result-card mb-8 last:mb-0 bg-dark-800 border border-red-900 rounded-lg p-6 neon-radial-gradient">
                <div class="flex items-center text-red-400">
                  <i class="fas fa-exclamation-circle mr-3 text-xl"></i>
                  <span class="font-medium">Error processing ${file.name}</span>
                </div>
                <p class="text-red-300 mt-2">No description returned from the AI model.</p>
              </div>
            `;
          }
        }

        if (allDescriptions) {
          responseBox.innerHTML = allDescriptions;
          showToast("Analysis complete! Results are ready", 'success');
        } else {
          responseBox.innerHTML = `
            <div class="bg-dark-800 border border-yellow-900 rounded-lg p-8 text-center neon-radial-gradient">
              <i class="fas fa-exclamation-triangle text-yellow-400 text-4xl mb-4"></i>
              <h3 class="font-medium text-yellow-300 text-xl mb-2">No results returned</h3>
              <p class="text-yellow-200">The AI didn't return any descriptions for your images.</p>
            </div>
          `;
          showToast("Analysis completed but no results returned", 'warning');
        }

        // Scroll to results
        responseBox.scrollIntoView({ behavior: 'smooth' });

      } catch (err) {
        console.error("Analysis error:", err);
        responseBox.innerHTML = `
          <div class="bg-dark-800 border border-red-900 rounded-lg p-8 neon-radial-gradient">
            <div class="flex items-center text-red-400 mb-4">
              <i class="fas fa-exclamation-circle mr-3 text-2xl"></i>
              <span class="font-medium text-xl">Error</span>
            </div>
            <p class="text-red-300">${err.message || 'An unknown error occurred during analysis'}</p>
            <div class="mt-4 p-3 bg-dark-700 rounded-lg">
              <p class="text-gray-400 text-sm">Technical details:</p>
              <code class="text-gray-500 text-xs">${err.stack || 'No stack trace available'}</code>
            </div>
          </div>
        `;
        
        showToast("Analysis failed! Please try again.", 'error');
      } finally {
        describeBtn.disabled = false;
        describeBtn.innerHTML = `<i class="fas fa-magic mr-3"></i> Analyze Images`;
        describeBtn.classList.remove('opacity-75');
      }
    });

    // Convert file to base64
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const base64String = reader.result.split(',')[1];
          resolve(base64String);
        };
        reader.onerror = () => {
          reject(new Error('Failed to read file'));
        };
        reader.readAsDataURL(file);
      });
    }

    // Format file size
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Global function to handle follow-up questions
    window.askFollowUp = async function(filename) {
      const questionInput = document.getElementById(`question-${filename.replace(/[^a-z0-9]/gi, '-')}`);
      const question = questionInput.value.trim();
      
      if (!question) {
        showToast("Please enter a question", 'warning');
        return;
      }

      const chatContainer = document.getElementById(`chat-${filename.replace(/[^a-z0-9]/gi, '-')}`);
      
      // Add user question to chat
      const userMessage = document.createElement('div');
      userMessage.className = 'chat-message user-message';
      userMessage.innerHTML = `
        <div class="flex items-end justify-end">
          <div class="max-w-[90%]">
            <p>${question}</p>
          </div>
        </div>
      `;
      chatContainer.appendChild(userMessage);
      
      // Clear input
      questionInput.value = '';
      
      // Scroll to bottom
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      // Get the chat session for this image
      const chat = chatSessions.get(filename);
      
      if (!chat) {
        showToast("Chat session not found for this image", 'error');
        return;
      }
      
      // Show loading indicator
      const loadingMessage = document.createElement('div');
      loadingMessage.className = 'chat-message ai-message';
      loadingMessage.innerHTML = `
        <div class="flex items-start">
          <div class="max-w-[90%]">
            <div class="flex items-center">
              <i class="fas fa-spinner fa-spin mr-2 text-neon-cyan"></i>
              <p>Thinking...</p>
            </div>
          </div>
        </div>
      `;
      chatContainer.appendChild(loadingMessage);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      try {
        // Send question to the chat session
        const result = await chat.sendMessage(question);
        const text = result.response.candidates?.[0]?.content?.parts?.[0]?.text;
        
        // Remove loading message
        loadingMessage.remove();
        
        // Add AI response to chat
        const aiMessage = document.createElement('div');
        aiMessage.className = 'chat-message ai-message';
        aiMessage.innerHTML = `
          <div class="flex items-start">
            <div class="max-w-[90%]">
              <p class="whitespace-pre-line">${text}</p>
            </div>
          </div>
        `;
        chatContainer.appendChild(aiMessage);
        
        // Scroll to bottom
        chatContainer.scrollTop = chatContainer.scrollHeight;
        
      } catch (err) {
        console.error("Error asking follow-up:", err);
        
        // Remove loading message
        loadingMessage.remove();
        
        // Show error message
        const errorMessage = document.createElement('div');
        errorMessage.className = 'chat-message ai-message bg-red-900 bg-opacity-30';
        errorMessage.innerHTML = `
          <div class="flex items-start">
            <div class="max-w-[90%]">
              <p class="text-red-300">Sorry, I couldn't process your question. Please try again.</p>
            </div>
          </div>
        `;
        chatContainer.appendChild(errorMessage);
        
        showToast("Error processing your question", 'error');
      }
    };

    // Global function to copy text to clipboard
    window.copyToClipboard = function(button, filename) {
      const resultCard = button.closest('.result-card');
      const textToCopy = resultCard.querySelector('p').textContent;
      navigator.clipboard.writeText(textToCopy);
      
      // Change button text temporarily
      const originalHTML = button.innerHTML;
      button.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
      setTimeout(() => {
        button.innerHTML = originalHTML;
      }, 2000);
      
      showToast("Copied to clipboard!", 'success');
    };

    // Global function to regenerate analysis
    window.regenerateAnalysis = async function(filename) {
      const file = Array.from(fileInput.files).find(f => f.name === filename);
      if (!file) {
        showToast("Image not found", 'error');
        return;
      }
      
      // Get the result card
      const resultCard = document.querySelector(`.result-card[data-filename="${filename}"]`);
      if (!resultCard) return;
      
      // Show loading state
      const originalContent = resultCard.innerHTML;
      resultCard.innerHTML = `
        <div class="flex items-center justify-center p-8">
          <div class="flex items-center">
            <i class="fas fa-spinner fa-spin text-neon-cyan mr-3"></i>
            <span class="text-neon-cyan">Regenerating analysis...</span>
          </div>
        </div>
      `;
      
      try {
        const { GoogleGenerativeAI } = await import("https://esm.sh/@google/generative-ai");
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        
        const base64 = await toBase64(file);
        const result = await model.generateContent([
          {
            inlineData: {
              mimeType: file.type,
              data: base64,
            },
          },
          {
            text: "Describe this image in detail, including objects, colors, actions, and any text present. Provide a comprehensive analysis suitable for accessibility purposes.",
          }
        ]);

        const text = result.response.candidates?.[0]?.content?.parts?.[0]?.text;
        if (text) {
          // Update the chat session with new analysis
          const chat = model.startChat({
            history: [
              {
                role: "user",
                parts: [{ 
                  inlineData: {
                    mimeType: file.type,
                    data: base64,
                  }
                }],
              },
              {
                role: "model",
                parts: [{ text: "I have received the image. Please provide your analysis request." }],
              },
              {
                role: "user",
                parts: [{ text: "Describe this image in detail, including objects, colors, actions, and any text present. Provide a comprehensive analysis suitable for accessibility purposes." }],
              },
              {
                role: "model",
                parts: [{ text: text }],
              }
            ]
          });
          
          // Store the updated chat session
          chatSessions.set(filename, chat);
          
          // Rebuild the result card with new analysis
          resultCard.innerHTML = `
            <div class="flex items-start mb-4">
              <div class="flex-shrink-0 bg-dark-700 border border-neon-cyan border-opacity-20 p-3 rounded-lg mr-4 shadow-neon-cyan/10">
                <i class="fas fa-image text-neon-cyan"></i>
              </div>
              <div>
                <h4 class="font-semibold text-white text-lg">${filename}</h4>
                <p class="text-sm text-gray-400">${formatFileSize(file.size)} • ${file.type}</p>
              </div>
            </div>
            <div class="bg-dark-700 rounded-lg p-4 border border-dark-600 neon-radial-gradient">
              <p class="text-gray-300 whitespace-pre-line">${text}</p>
            </div>
            
            <!-- Follow-up chat interface -->
            <div class="mt-6">
              <div class="flex items-center mb-3">
                <div class="h-px flex-1 bg-gradient-to-r from-transparent via-neon-purple to-transparent"></div>
                <span class="px-3 text-sm text-neon-cyan">Ask about this image</span>
                <div class="h-px flex-1 bg-gradient-to-r from-transparent via-neon-purple to-transparent"></div>
              </div>
              
              <div id="chat-${filename.replace(/[^a-z0-9]/gi, '-')}" class="chat-container flex flex-col space-y-3 mb-3 max-h-60 overflow-y-auto p-2"></div>
              
              <div class="flex gap-2">
                <input 
                  type="text" 
                  id="question-${filename.replace(/[^a-z0-9]/gi, '-')}" 
                  class="chat-input flex-1 rounded-lg px-4 py-2 focus:outline-none" 
                  placeholder="Ask a follow-up question..."
                >
                <button 
                  onclick="askFollowUp('${filename}')" 
                  class="chat-send-btn rounded-lg px-4 py-2 flex items-center justify-center"
                >
                  <i class="fas fa-paper-plane mr-2"></i> Send
                </button>
              </div>
            </div>
            
            <div class="mt-3 flex justify-between">
              <button class="text-xs text-neon-purple hover:text-neon-cyan transition-colors duration-300 flex items-center" onclick="copyToClipboard(this, '${filename}')">
                <i class="fas fa-copy mr-1"></i> Copy
              </button>
              <button class="text-xs text-neon-purple hover:text-neon-cyan transition-colors duration-300 flex items-center" onclick="regenerateAnalysis('${filename}')">
                <i class="fas fa-sync-alt mr-1"></i> Regenerate
              </button>
            </div>
          `;
          
          showToast("Analysis regenerated successfully", 'success');
        } else {
          throw new Error("No text returned from AI");
        }
      } catch (err) {
        console.error("Error regenerating analysis:", err);
        resultCard.innerHTML = originalContent;
        showToast("Failed to regenerate analysis", 'error');
      }
    };
  </script>
</body>
</html>